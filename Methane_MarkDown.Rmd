---
title: "Methane in Hector"
author: "Natalie Crowe"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Building a Hector Core

Our first step is to create a core. Hector will use this to pull data from existing climate projections. Our projections will be from SSP245.

```{r  Hector-core, message=FALSE}
library(hector)
library(ggplot2)
library(dplyr)
ini_file <- system.file("input/hector_ssp245.ini", package = "hector")
core <- newcore(ini_file)
run(core)
```

## Methane Emissions Data and Graph

After creating and running the core we query it for methane-related outputs
between the years of 1745 and 2100. Hector has several options that relate to methane, including emissions, concentration, postindustrial, natural, soil lifetime and stratosphere lifetime.

```{r Emissions-data-frame}
results<- fetchvars(core, 1745:2100, c(EMISSIONS_CH4(),
                                       CONCENTRATIONS_CH4()))
invisible(shutdown(core))
head(results)
```

### Plot Results Methane Emissions

Now we have all the things we need to build a simple plot of methane emissions between the years 1745 and 2100. The `ggplot2` package is helpful for making graphs quickly and simply. We already loaded this package at the beginning of this file. 

```{r Emissions-plot}
results %>% 
  filter(variable == EMISSIONS_CH4()) %>% 
  ggplot(aes(x= year, y= value))+
    geom_line(color="blue")+
    labs(x = "Year",
         y = "Methane Emissions (Tg)",
         title = "Methane Emissions 1745-2100 in SSP245")
```

## Methane Concentrations

By changing the input `EMISSION_CH4()` to `CONCENTRATIONS_CH4()` we can replicate our code to get different visualized data.

```{r Concentration-graph}
results %>% 
  filter(variable == CONCENTRATIONS_CH4()) %>% 
  ggplot(aes(x= year, y= value))+
    geom_line(color= "red")+
    labs(x = "Year",
         y = "Methane Concentration (ppbv)",
         title = "Methane Concentration 1745-2100 in SSP245")
```

### Adding Another Dataframe
Let’s compare this data to NOAA’s data of yearly mean CH4 increase. We first have to read the file using read.table, then we can assign names to each column.
```{r}
noaa <- read.table("noaa_data/ch4_annmean_gl.txt.txt", skip = 61)

noaa_data <- noaa %>%
  rename(year = V1, mean = V2, unc = V3) %>%
  # Remove this column to keep only what the NOAA and Hector data sets have in common
  select(-unc)

hector_data <- results %>%
  # Pull out only the years of the NOAA dataset and just the CH4 concentration values
  filter(year %in% noaa_data$year,
         variable == "CH4_concentration") %>%
  # We only care about the year and mean because that's what we have in common with NOAA
  select(year,
         mean = value)

# We will use the same datasets for both examples

## Method 1 for plotting
# Use an empty ggplot call, then pass in individual data and aes arguments to 
# two distinct geom calls
# Using the color = "noaa" argument will tell ggplot to give the geom_line
# a color and to report the value in the legend as "noaa"
ggplot() +
  geom_line(data = noaa_data, aes(x = year, y = mean, color = "NOAA")) +
  geom_line(data = hector_data, aes(x = year, y = mean, color = "Hector")) +
  labs(x = "Year", 
       y = "ppb",
       color = "Source")

## Method 2 for plotting
# Combine data frames into one using bind_rows()
# Assign identifier so that we can separate the data later
noaa_data2 <- noaa_data %>%
  mutate(source = "NOAA")

hector_data2 <- hector_data %>%
  mutate(source = "Hector")

# Combine
plot_data <- bind_rows(noaa_data2, hector_data2) 

# Plot like you would normally, and specify color by source
ggplot(plot_data, aes(x = year, y = mean, color = source)) +
  geom_line()  +
  labs(x = "Year", 
       y = "ppb",
       color = "Source")

```
We can then plot for the NOAA data.

```{r}
noaa_data %>%
  ggplot(aes(x= year, y= mean))+
  geom_line(color= "green") +
  labs(x = "Year",
       y = "Increase of CH4 (ppb)",
       title = "NOAA- Annuel Global Increase of CH4")
```


## Comparison Plots

We can put these two results into a single graph...
```{r Comparison-graph}
ggplot(data= results, aes(x= year, y= value, color= units))+
    geom_line()+
    labs(x = "Year",
         y = NULL,
         title = "Methane Concentration/Emission 1745-2100 in SSP245",
         color = "Units") + facet_wrap(~variable)
```
... to show our data side-by-side.
